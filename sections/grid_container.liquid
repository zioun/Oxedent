<style>
  * {
    padding: 0;
    margin: 0;
    box-sizing: border-box;
  }
  .common__title {
    font-size: 30px;
    font-weight: bold;
    color: #001F51;
    text-align: center;
  }
  .container {
    max-width: 900px;
    margin: auto;
  }
  .grid__ad__page__area {
    background-color: white;
  }
  .grid__ad__page__section {
    margin-top: 20px;
    display: flex;
    justify-content: center;
  }
  .grid__ad__page__title {
    font-size: 38px;
    color: #001F51;
    text-align: center;
    font-weight: bold;
    padding-bottom: 10px;
    margin-top: 42px;
    margin-bottom: 30px;
  }
  .grid-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }
  .grid-item {
    background-color: #fff;
    border-radius: 10px;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
  }
  .grid-item img,
  .grid-item video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .grid-item img:hover {
    opacity: 0.7;
  }
  .grid-item video:hover {
    opacity: 0.7;
  }
  /* Lightbox Styles */
  .lightbox {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
  }
  .lightbox-content {
    position: relative;
    margin: auto;
    top: 50%;
    transform: translateY(-50%);
    max-width: 90%;
    text-align: center;
  }
  .lightbox img,
  .lightbox video {
    max-width: 100%;
    height: 800px;
  }
  .close {
    position: absolute;
    top: 20px;
    right: 30px;
    color: white;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
  }

  .arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 50px;
    color: white;
    cursor: pointer;
    user-select: none;
  }

  .arrow-left {
    left: 30px;
  }

  .arrow-right {
    right: 30px;
  }
</style>

<section class="grid__ad__page__area container">
  <div class="grid__ad__page__section">
    <div class="container">
      <h1 class="grid__ad__page__title">{{ section.settings.grid__ad__page__title }}</h1>
      <div class="grid-container">
        {% for block in section.blocks %}
          <div class="grid-item" style="grid-row: span {{ block.settings.grid__span | default: 1 }};">
            {% case block.type %}
              {% when "grid__container" %}
                {% if block.settings.grid__image != nil %}
                  <img
                    src="{{ block.settings.grid__image | image_url: width: 800 }}"
                    alt="Grid Image"
                    onclick="openLightbox(this, {{ forloop.index0 }})">
                {% endif %}
                {% if block.settings.grid__video != nil %}
                  {{ block.settings.grid__video 
                     | video_tag: autoplay: true, loop: true, muted: true, controls: false, image_size: '600x' }}
                {% endif %}
            {% endcase %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Grid__Ad Page",
  "settings": [
    {
      "type": "text",
      "id": "grid__ad__page__title",
      "default": "Grid Ad Page",
      "label": "Grid Ad Page Title"
    }
  ],
  "blocks": [
    {
      "name": "grid__container",
      "type": "grid__container",
      "settings": [
        {
          "type": "image_picker",
          "id": "grid__image",
          "label": "Grid Image"
        }, {
          "type": "video",
          "id": "grid__video",
          "label": "Grid Video"
        }, {
          "type": "range",
          "id": "grid__span",
          "min": 1,
          "max": 3,
          "step": 1,
          "unit": "px",
          "label": "Grid Span",
          "default": 1
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Grid Ad Page",
      "blocks": [
        {
          "type": "grid__container"
        }
      ]
    }
  ]
}
{% endschema %}

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <span class="close" onclick="closeLightbox()">&times;</span>
  <div class="lightbox-content" id="lightbox-content"></div>
  <span class="arrow arrow-left" onclick="changeImage(-1)">&#10094;</span>
  <span class="arrow arrow-right" onclick="changeImage(1)">&#10095;</span>
  <div id="position-text" style="color: white; position: absolute; top: 10px; left: 50px; font-size: 20px;">
    1/10
  </div>
</div>

<script>
  var currentIndex = 0;
  var items;

  function getVisibleItems() {
    return Array.from(document.querySelectorAll('.grid-item img, .grid-item video')).filter(function (el) {
      return el.offsetParent !== null;
    });
  }

  window.onload = function () {
    items = getVisibleItems();
    totalItems = items.length;

    document.querySelectorAll('.grid-item video').forEach(function (video, index) {
      video.addEventListener('click', function () {
        openLightbox(video, index);
      });
    });
  };

  function openLightbox(element, index) {
    currentIndex = index;

    if (element.tagName === "VIDEO") {
      var videoSource = element.src || element.currentSrc;
      document.getElementById("lightbox-content").innerHTML = `
      <video loop autoplay controls playsinline>
        <source src="${videoSource}" type="video/mp4">
      </video>`;
    } else {
      document.getElementById("lightbox-content").innerHTML = element.outerHTML;
    }

    document.getElementById("lightbox").style.display = "block";
    updatePositionText();
  }

  function closeLightbox() {
    document.getElementById("lightbox").style.display = "none";
  }

  function changeImage(direction) {
    currentIndex += direction;

    if (currentIndex < 0) {
      currentIndex = items.length - 1;
    } else if (currentIndex >= items.length) {
      currentIndex = 0;
    }

    updateLightbox(items[currentIndex]);
    updatePositionText();
  }

  function updateLightbox(element) {
    if (element.tagName === "VIDEO") {
      var videoSource = element.src || element.currentSrc;
      document.getElementById("lightbox-content").innerHTML = `
      <video loop autoplay controls playsinline>
        <source src="${videoSource}" type="video/mp4">
      </video>`;
    } else {
      document.getElementById("lightbox-content").innerHTML = element.outerHTML;
    }
  }

  function updatePositionText() {
    document.getElementById("position-text").textContent = (currentIndex + 1) + "/" + items.length;
  }

  window.onclick = function (event) {
    var lightbox = document.getElementById("lightbox");
    if (event.target === lightbox) {
      closeLightbox();
    }
  }
</script>
